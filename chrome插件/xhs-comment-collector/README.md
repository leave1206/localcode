# 小红书评论采集插件 v2.1

## 🚀 功能迭代说明

### 本次更新内容

#### 1. 前端界面重新布局
- **添加监控区域**：独立放在最顶部，方便用户快速添加新的品牌监控任务
- **品牌切换模块**：当存在多个品牌监控任务时，显示品牌切换器，支持快速切换
- **监控管理区域**：放在中间位置，包含编辑、开启/停止、立即采集、删除等操作
- **数据下载区域**：支持多种格式的数据导出（JSON、Excel、当日、昨日）
- **笔记评论展示区域**：放在最下方，实时显示当前选中品牌的评论数据

#### 2. 多品牌监控支持
- **独立数据存储**：每个品牌任务都有独立的存储键（`xhs_comments_brand_{id}.json`）
- **品牌信息管理**：每个品牌包含品牌名、品牌介绍、监控要求、笔记链接清单
- **数据隔离**：不同品牌的评论数据完全独立，互不影响
- **品牌切换**：支持在多个品牌任务间快速切换，每个品牌显示对应的监控管理和评论数据

#### 3. 数据导出增强
- **品牌标识**：导出的文件名包含品牌名称，便于区分不同品牌的数据
- **多格式支持**：支持JSON和Excel格式，支持全部数据、当日数据、昨日数据
- **数据完整性**：导出的数据包含完整的品牌信息和元数据

## 📋 使用方法

### 1. 添加品牌监控
1. 点击顶部的"添加品牌监控"按钮
2. 填写品牌/产品名称（必填）
3. 填写品牌/产品介绍（选填）
4. 填写评论分析要求（选填）
5. 上传包含笔记链接的Excel文件
6. 点击"确认"保存

### 2. 品牌切换
- 当存在多个品牌监控任务时，会在添加监控下方显示品牌切换模块
- 点击对应的品牌标签即可切换到该品牌
- 切换后，下方的监控管理、评论展示等都会显示对应品牌的数据

### 3. 监控管理
- **编辑监控**：修改品牌信息、监控要求、笔记链接等
- **开启监控**：启动定时监控任务
- **立即采集**：手动触发立即开始采集
- **删除监控**：删除当前选中的品牌监控任务，保留其他品牌数据

### 4. 数据下载
- **全部数据**：下载当前品牌的所有评论数据
- **当日数据**：下载当前品牌当日发布的评论数据
- **昨日数据**：下载当前品牌昨日发布的评论数据
- **格式选择**：支持JSON和Excel两种格式

## 🔧 技术架构

### 数据存储结构
```
monitorBrands: [
  {
    id: 1234567890,
    brandName: "品牌名称",
    brandDesc: "品牌介绍",
    monitorReq: "监控要求",
    noteLinks: ["链接1", "链接2", ...],
    createdAt: 1234567890
  }
]

xhs_comments_brand_1234567890.json: {
  _meta: {
    brandId: 1234567890,
    brandName: "品牌名称",
    brandDesc: "品牌介绍",
    monitorReq: "监控要求",
    noteLinks: ["链接1", "链接2", ...],
    createdAt: 1234567890,
    collectionCompletedAt: "2024-01-01 12:00"
  },
  "1": {
    noteId: "笔记ID",
    note_url: "笔记链接",
    note_title: "笔记标题",
    note_author: "笔记作者",
    comments: [...],
    comments_total: 100,
    collection_time: "2024-01-01",
    lastUpdated: "2024-01-01T12:00:00.000Z"
  }
}
```

### 核心功能模块
- **前端界面**：popup.html + popup.js，负责用户交互和数据展示
- **后台调度**：background.js，负责定时任务和任务管理
- **内容采集**：content.js，负责页面数据采集和存储
- **数据管理**：支持多品牌数据的独立存储和管理

## ⚠️ 注意事项

1. **数据独立性**：每个品牌的数据完全独立，删除品牌会清空该品牌的所有数据
2. **存储空间**：长期使用可能占用较多存储空间，建议定期清理不需要的数据
3. **品牌切换**：切换品牌后，所有操作（监控、下载等）都会针对当前选中的品牌
4. **删除操作**：删除监控只会删除当前选中的品牌，其他品牌数据会保留
5. **兼容性**：新版本兼容旧版本的数据格式，会自动迁移到新的多品牌架构

## 🔄 版本历史

- **v2.1.1**：修复CSP错误和品牌切换问题，优化事件绑定机制，修复删除监控逻辑
- **v2.1**：新增多品牌监控支持，重新设计前端界面，支持品牌切换和数据隔离
- **v2.0**：重构数据存储机制，新增增量采集功能，完善时间标准化处理
- **v1.2**：新增点赞数采集和Excel导出功能
- **v1.1**：优化采集性能，增加超时控制
- **v1.0**：基础评论采集功能发布
